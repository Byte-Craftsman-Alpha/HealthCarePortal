{% extends 'admin_base.html' %}
{% block content %}
  <div class="flex items-start justify-between gap-4 flex-wrap">
    <div>
      <div class="text-xs uppercase tracking-[0.2em]" style="color: var(--admin-muted);">Access control</div>
      <h1 class="text-xl font-semibold mt-1">Users</h1>
      <p class="text-sm mt-2 max-w-2xl" style="color: var(--admin-muted);">Manage roles for identities in the system. Changes are immediately effective and audited.</p>
    </div>
    <div class="flex gap-3 flex-wrap">
      <a class="admin-btn admin-btn-soft" href="{{ url_for('admin.overview') }}">
        <span class="iconify" data-icon="solar:arrow-left-linear"></span>
        Overview
      </a>
      <a class="admin-btn admin-btn-soft" href="{{ url_for('admin.audit_logs') }}">
        <span class="iconify" data-icon="solar:document-text-linear"></span>
        Audit logs
      </a>
    </div>
  </div>

  <div class="admin-card p-6 mt-6">
    <div class="flex items-center justify-between gap-4 flex-wrap">
      <div>
        <div class="text-xs uppercase tracking-[0.2em]" style="color: var(--admin-muted);">Directory</div>
        <div class="text-sm mt-2" style="color: var(--admin-muted);">{{ users|length }} users</div>
      </div>
      <div class="text-sm" style="color: var(--admin-muted);">
        Tip: Keep admin accounts minimal; use audit logs for investigations.
      </div>
    </div>

    <div class="mt-5 overflow-x-auto">
      <table class="min-w-full admin-table">
        <thead>
          <tr>
            <th class="text-left px-4 py-3">ID</th>
            <th class="text-left px-4 py-3">Email</th>
            <th class="text-left px-4 py-3">Role</th>
            <th class="text-left px-4 py-3">Created</th>
            <th class="text-left px-4 py-3">Update</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
            <tr style="border-top: 1px solid var(--admin-border);">
              <td class="px-4 py-3 text-sm">{{ u.id }}</td>
              <td class="px-4 py-3 text-sm">{{ u.email }}</td>
              <td class="px-4 py-3 text-sm">{{ u.role }}</td>
              <td class="px-4 py-3 text-sm" style="color: var(--admin-muted);">{{ u.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
              <td class="px-4 py-3">
                <form method="post" class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-2 items-center">
                  <input type="hidden" name="user_id" value="{{ u.id }}" />
                  <select class="admin-input" name="role">
                    <option value="patient" {% if u.role=='patient' %}selected{% endif %}>patient</option>
                    <option value="doctor" {% if u.role=='doctor' %}selected{% endif %}>doctor</option>
                    <option value="admin" {% if u.role=='admin' %}selected{% endif %}>admin</option>
                    <option value="pharmacy" {% if u.role=='pharmacy' %}selected{% endif %}>pharmacy</option>
                    <option value="emergency" {% if u.role=='emergency' %}selected{% endif %}>emergency</option>
                  </select>
                  <button class="admin-btn admin-btn-primary" type="submit">Save</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
