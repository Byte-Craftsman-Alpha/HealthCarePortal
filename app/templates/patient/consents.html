{% extends 'base.html' %}
{% block content %}
  <h1 class="text-xl font-semibold text-slate-900">Doctor Consents</h1>
  <p class="text-sm text-slate-500 mt-1">Grant or revoke access. Doctors can only see you when consent is active.</p>

  <div class="minimal-card p-6 mt-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {% for d in doctors %}
        {% set c = consent_by_doctor.get(d.user_id) %}
        <div class="border border-slate-200 rounded-2xl p-5">
          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="text-sm font-semibold text-slate-900">Doctor #{{ d.user_id }}</div>
              <div class="text-sm text-slate-500 mt-1">{{ d.specialization }}</div>
              <div class="text-xs text-slate-500 mt-2">Hospital: {{ d.hospital_id or 'N/A' }}</div>
            </div>
            <div class="text-right">
              {% if c and c.revoked_at is none %}
                <div class="text-xs uppercase tracking-wider text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-full px-3 py-1 inline-block">Active</div>
              {% elif c and c.revoked_at is not none %}
                <div class="text-xs uppercase tracking-wider text-rose-700 bg-rose-50 border border-rose-200 rounded-full px-3 py-1 inline-block">Revoked</div>
              {% else %}
                <div class="text-xs uppercase tracking-wider text-slate-500 bg-slate-50 border border-slate-200 rounded-full px-3 py-1 inline-block">Not granted</div>
              {% endif %}
            </div>
          </div>

          <div class="mt-4 flex gap-3 flex-wrap">
            <form method="post">
              <input type="hidden" name="doctor_id" value="{{ d.user_id }}" />
              <input type="hidden" name="action" value="grant" />
              <button class="minimal-btn minimal-btn-primary" type="submit">
                <span class="iconify" data-icon="solar:shield-check-linear"></span>
                Grant
              </button>
            </form>

            <form method="post">
              <input type="hidden" name="doctor_id" value="{{ d.user_id }}" />
              <input type="hidden" name="action" value="revoke" />
              <button class="minimal-btn admin-btn-soft" type="submit">
                <span class="iconify" data-icon="solar:shield-cross-linear"></span>
                Revoke
              </button>
            </form>
          </div>

          {% if c and c.granted_at %}
            <div class="text-xs text-slate-500 mt-3">Granted: {{ c.granted_at.strftime('%Y-%m-%d %H:%M') }}</div>
          {% endif %}
          {% if c and c.revoked_at %}
            <div class="text-xs text-slate-500 mt-1">Revoked: {{ c.revoked_at.strftime('%Y-%m-%d %H:%M') }}</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}
