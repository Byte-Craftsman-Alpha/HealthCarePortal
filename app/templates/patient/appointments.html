{% extends 'base.html' %}
{% from 'components/ui.html' import card, label, input, select, btn, section_title %}
{% block content %}
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    {% call card(cls='p-6 lg:col-span-1') %}
      <div class="text-lg font-semibold" style="color: var(--text-primary);">Book</div>
      <form method="post" class="space-y-4 mt-4">
        <div>
          {{ label('doctor_id', 'Doctor') }}
          {% set doctor_options = [] %}
          {% for d in doctors %}
            {% set _ = doctor_options.append((d.user_id, (d.user.name or ('Doctor #' ~ d.user_id)) ~ ' Â· ' ~ d.specialization)) %}
          {% endfor %}
          {{ select('doctor_id', 'doctor_id', doctor_options, selected=selected_doctor_id, required=True) }}
        </div>
        <div>
          {{ label('scheduled_at', 'Date & time') }}
          {{ input('scheduled_at', 'scheduled_at', type='datetime-local', required=True) }}
        </div>
        {{ btn('Request appointment', icon_name='solar:calendar-add-linear', variant='primary', type='submit', cls='w-full') }}
      </form>
    {% endcall %}

    {% call card(cls='p-6 lg:col-span-2') %}
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold" style="color: var(--text-primary);">Your schedule</h2>
        <span class="text-xs" style="color: var(--text-muted);">{{ appointments|length }} items</span>
      </div>

      <div class="mt-4 space-y-3">
        {% if appointments|length == 0 %}
          <div class="text-sm" style="color: var(--text-muted);">No appointments booked yet.</div>
        {% endif %}

        {% for a in appointments %}
          <div class="rounded-2xl p-4 flex items-start justify-between gap-4" style="border: 1px solid var(--border-secondary);">
            <div>
              <div class="text-sm font-medium" style="color: var(--text-primary);">{{ a.scheduled_at.strftime('%Y-%m-%d %H:%M') }}</div>
              <div class="text-xs mt-1" style="color: var(--text-muted);">Doctor #{{ a.doctor_id }}</div>
              <div class="text-xs mt-1" style="color: var(--text-muted);">Status: {{ a.status }}</div>
            </div>
            <span class="text-xs" style="color: var(--text-muted);">Appointment #{{ a.id }}</span>
          </div>
        {% endfor %}
      </div>
    {% endcall %}
  </div>
{% endblock %}
